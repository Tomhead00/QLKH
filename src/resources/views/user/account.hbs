<div id="logreg-forms">
    <form class="form-signin">
        <h1 class="h3 mb-3 font-weight-normal" style="text-align: center"> Đăng nhập</h1>
        <div class="social-login">
            <button class="btn facebook-btn social-btn" type="button"><span><i class="fab fa-facebook-f"></i> Đăng nhập với Facebook</span> </button>
            <button class="btn google-btn social-btn" type="button"><span><i class="fab fa-google-plus-g"></i> Đăng nhập với Google+</span> </button>
        </div>
        <p style="text-align:center"> Hoặc  </p>
        <div class="input-group">
            <input type="email" id="inputEmail" class="form-control" placeholder="Email address" required="" autofocus="">
        </div>

        <div class="input-group">
            <input type="password" id="inputPassword" class="form-control" placeholder="Password" required="">
        </div>
        <p id="alert-login" style="display: none"></p>

        <div class="input-group">
            <button class="btn btn-md btn-rounded btn-block form-control submit" type="submit"><i class="fas fa-sign-in-alt"></i> Đăng nhập</button>
        </div>

        <a href="#" id="forgot_pswd">Quên mật khẩu</a>
        <hr>
        <!-- <p>Don't have an account!</p>  -->
        <button class="btn btn-primary btn-block" type="button" id="btn-signup"><i class="fas fa-user-plus"></i> Tạo tài khoản mới</button>
    </form>

    <form action="#" class="form-reset">
        <input type="email" id="resetEmail" class="form-control" placeholder="Email address" required="" autofocus="">
        <button class="btn btn-primary btn-block" type="submit">Khôi phục mật khẩu</button>
        <a href="#" id="cancel_reset"><i class="fas fa-angle-left"></i> Back</a>
    </form>

    <form method="POST" action="./account/create" class="form-signup">
        <div class="social-login">
            <button class="btn facebook-btn social-btn" type="button"><span><i class="fab fa-facebook-f"></i> Đăng nhập với Facebook</span> </button>
            </div>
            <div class="social-login">
            <button class="btn google-btn social-btn" type="button"><span><i class="fab fa-google-plus-g"></i> Đăng nhập với Google+</span> </button>
        </div>

        <p style="text-align:center">Hoặc</p>

        <input type="text" name="username" id="user-name" class="form-control" placeholder="Full name" required="" autofocus="">
        <p id="alert-username" style="display: none">Tên tài khoản tồn tại! Vui lòng thử lại!</p>
        <input type="email" name="email" id="user-email" class="form-control" placeholder="Email address" required autofocus="">
        <p id="alert-email" style="display: none">Email đã được đăng ký! Vui lòng thử lại!</p>
        <input type="password" name="password" id="user-pass" class="form-control" placeholder="Password" required autofocus="">
        <input type="password" name="passwordConfirmation" id="user-repeatpass" class="form-control" placeholder="Confirm Password" required autofocus="">
        <p id="alert-password" style="display: none">Mật khẩu nhập lại không đúng! Vui lòng nhập lại!</p>
        <div class="input-group">
        <button class="btn btn-md btn-block submit" type="submit"><i class="fas fa-user-plus"></i> Đăng ký</button>
        </div>

        <a href="#" id="cancel_signup"><i class="fa fa-angle-left"></i> Quay lại</a>
    </form>
    <br>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var password = $("#user-pass");
        var repassword = $("#user-repeatpass");
        var alert_username = $("#alert-username");
        var alert_password = $("#alert-password");
        var alert_email = $("#alert-email");
        var username = $("#user-name");
        var email = $("#user-email");

        // login
        var login = $(".btn.btn-md.btn-rounded.btn-block.form-control.submit");
        var alert_login = $("#alert-login")
        var emailInput = $("#inputEmail");
        var passwordInput = $("#inputPassword");


        function toggleResetPswd(e){
            e.preventDefault();
            $('#logreg-forms .form-signin').toggle() // display:block or none
            $('#logreg-forms .form-reset').toggle() // display:block or none
        }

        function toggleSignUp(e){
            e.preventDefault();
            $('#logreg-forms .form-signin').toggle(); // display:block or none
            $('#logreg-forms .form-signup').toggle(); // display:block or none
        }

        $(()=>{
            // Login Register Form
            $('#logreg-forms #forgot_pswd').click(toggleResetPswd);
            $('#logreg-forms #cancel_reset').click(toggleResetPswd);
            $('#logreg-forms #btn-signup').click(toggleSignUp);
            $('#logreg-forms #cancel_signup').click(toggleSignUp);
        })

        // Check password
        $("#user-pass,#user-repeatpass").keyup(function checkpassword() {
            if(password.val() == repassword.val()) {
                alert_password.attr('style', 'display: none');
                repassword.attr('style', false);
            } else {
                repassword.attr('style', 'border-color: red');
                alert_password.attr('style', 'display: inline; color: red');
            }
        });
        // Check username
        username.keyup(function checkusername() {
            $.ajax({
                url: './account/check_username',
                type: 'POST',
                data: {
                    username: username.val()
                }
            }).done(function(ketqua) {
                if (ketqua == 1) {
                    alert_username.attr('style', 'display: inline; color: red');
                    username.attr('style', 'border-color: red');
                } else {
                    alert_username.attr('style', 'display: none');
                    username.attr('style', false);
                }
            });
        });
        // Check email
        email.keyup(function checkemail() {
            $.ajax({
                url: './account/check_email',
                type: 'POST',
                data: {
                    email: email.val()
                }
            }).done(function(ketqua) {
                if (ketqua == 1) {
                    alert_email.attr('style', 'display: inline; color: red');
                    email.attr('style', 'border-color: red');

                } else {
                    alert_email.attr('style', 'display: none');
                    email.attr('style', false);
                }
            });
        });

        //submit create account
        $('.btn.btn-md.btn-block.submit').click(function(e) {
            var check = $('.form-signup').find("input[style='border-color: red']").length;
            console.log(check);
            if(check > 0) {
                e.preventDefault();
            }
        })

        // Login
        login.click(function(e) {
            e.preventDefault();
            $.ajax({
                url: './account/login',
                type: 'POST',
                data: {
                    email: emailInput.val(),
                    password: passwordInput.val(),
                }
            }).done(function(ketqua) {
                if (ketqua != "Đăng nhập thành công!") {
                    alert_login.html(ketqua);
                    alert_login.attr('style', 'display: block; color: red; text-align: center');
                } else {
                    window.location.href = "./";
                }
            });
        });
    })
</script>